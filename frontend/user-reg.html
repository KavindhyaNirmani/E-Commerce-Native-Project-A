<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gather & Grab</title>
  <link rel="icon" type="image/png" href="./assets/images/logo.png" />


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet "
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <link rel="stylesheet" href="./assets/styles/user-reg.css" />
  <link rel="stylesheet" href="./assets/styles/reg-success.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

</head>

<body>

  
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-6 px-0 d-none d-sm-block" style="position: relative;">
                
          <img src="./assets/images/reg-bg-img.jpg" alt="Login image" class="w-100 min-vh-100 image-section"
            style="object-fit: cover; object-position: left;">
          <div class="text-overlay position-absolute top-0 end-0 p-3">
            <h2 class="text-white">Gather & Grab</h2>
          </div>
        </div>

        <div class="col-sm-6 header pt-4 form-section" style="font-family: 'Lato', sans-serif;">
          <div class="px-2 py-0 ms-xl-2 text-center">
            <img src="./assets/images/logo.png" class="d-md-none d-sm-none d-xs-block logo_icon" style="width: 80px; min-height: 80px;" >
            <h1 class="fw-bold mb-0 pt-5  text-style">Start your delicious journey with us</h1>
            <h3 class="pb-2" style="color:#FAD700;">Sign up now!</h3>
          </div>

          <div class="d-flex justify-content-center align-items-center ms-xl-4 mt-0 pt-0 pt-xl-0 mt-xl-n5">
            
            <form id="registerForm" method="POST" class="needs-validation" novalidate style="font-family: 'Lato', sans-serif;">

              <div class="form-group row custom-padding">
                <label for="email" class="col-md-3 col-form-label">Email</label>
                <div class="col-md-9">
                  <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                  <div class="invalid-feedback">Please enter your email.</div>
                </div>                                                                    
              </div>

              <div class="form-group row custom-padding">
                <label for="userName" class="col-md-3 col-form-label">Username</label>
                <div class="col-md-9">
                  <input type="text" class="form-control" id="userName" placeholder="Enter your username" required>
                  <div class="invalid-feedback">Please enter your username.</div>
                </div>
              </div>

              <div class="form-group row custom-padding">
                <label for="password" class="col-md-3 col-form-label">Password</label>
                <div class="col-md-9">
                  <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                  <div class="invalid-feedback">Please enter your password.</div>
                </div>
              </div>

              <div class="form-group row custom-padding">
                <label for="confirmPassword" class="col-md-3 col-form-label">Confirm Password</label>
                <div class="col-md-9">
                  <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your password" required>
                  <div class="invalid-feedback">Please confirm your password.</div>
                </div>
              </div>

              <button type="submit" class="mt-3 w-100 fw-bold custom-btn p-1 " >Signup</button>

              <p class="pb-5">Already a Member? <a href="./user-login.html">Login</a></p>
            </form>
          </div>
        </div>
      </div>
    </div>
  

  <!-- Load Modal -->
  <div id="success-modal-content"></div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('registerForm');
      
      // Listen for form submission
      form.addEventListener('submit', async function (event) {
        event.preventDefault();  // Prevent default form submission

        // Validate the form using Bootstrap validation classes
        if (!form.checkValidity()) {
          event.stopPropagation();
          form.classList.add('was-validated');
          return;
        }

        // Get form values
        const email = document.getElementById('email').value;
        const username = document.getElementById('userName').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // Password match validation
        if (password !== confirmPassword) {
          alert('Passwords do not match.');
          return;
        }

        // Send both password and confirmPassword in the payload
        try {
          console.log("Sending data to the server:", { email, username, password, confirmPassword });

          const response = await fetch('http://localhost:5010/auth/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            // Send both password and confirmPassword to the server
            body: JSON.stringify({ email, username, password, confirmPassword })
          });

          const data = await response.json();
          console.log("Response from server:", data);

          if (response.ok) {
          // Load the modal from the external file and show it
          $('#success-modal-content').load('./reg-success.html', function () {
             
          $("#successModal").modal("show");
          })
            
          } else {
            alert(data.message || 'Registration failed.');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        }
      });
    });


  </script>

  
  
</body>

</html>