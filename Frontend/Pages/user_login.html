<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gather & Grab-User Login</title>
    <link rel="icon" type="image/png" href="../Assets/Images/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <link rel="stylesheet" href="../Assets/Styles/user_login.css">

    <link rel="stylesheet" href="../Assets/Styles/log_fail.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</head>



<body>
    
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6 px-0 d-none d-sm-block image-section" style="position: relative;">
              <img src="../Assets/Images/login_image.jpg"
                alt="Login image" class="w-100 vh-100" style="object-fit: cover; object-position: left;">
                
                <div class="text-overlay">
                  <h2 class="text-white">Gather & Grab</h2>
                  </div>
      
            </div>

            <div class="col-sm-6 pt-2 header" style="font-family: 'Lato' ,sans-serif;" >
                <div class="px-1 py-0 ms-xl-2 text-center flex justify-content-center " >

                  <img src="../Assets/Images/Logo_icon.png" class="d-md-none d-sm-none d-xs-block" style="width: 100px; ">
                    <p class="h2 fw-bold mb-0 text-white p-custom" style="font-family:'lato',sans-serif; ">Ready for Another Taste?</p>
                    <h2 class="pb-3" style="color:#FAFF00;  ">Login now!</h2>

                </div>
                  
          
                  <div class="d-flex justify-content-center align-items-center px-1 ms-xl-4 mt-2 pt-0 pt-xl-0 mt-xl-n5 " >
          
                    <form method="POST" class="needs-validation" novalidate onsubmit="loginUser(event)" style="font-family: 'Lato' ,sans-serif;">
                      <div class=" form-group row custom-padding"  >
                          <label for="username" class="col-md-4 col-form-label">Username</label>
                          <div class="col-md-8">
                          <input type="text" class="form-control " id="username"  placeholder="Enter your username" required >
                          <div class="invalid-feedback">
                            Please Enter your username
                          </div>
                      </div>
                    </div>

                      <div class="form-group row custom-padding">
                        <label for="password" class="col-md-4 col-form-label">Password</label>
                        <div class="col-md-8">
                        <input type="password" class="form-control" id="password"  placeholder="Enter your password" required>

                        <div class="invalid-feedback">
                          Please provide your username
                        </div>
                      </div>
                    </div>

                    
                       
                      <button type="submit" class="btn mt-3 w-100 fw-bold custom-hover p-1" >Login</button>
                      
                      <p>Not a Member? 
                        <a href="../Pages/user_reg.html" > Signup </a>
                      </p>
                    
                    </div>

                    </form>
                    
                  
                  </div>
                    
                  </div>
              </div>
            </div>
        


         <div id="failed-modal-container"></div>

         <script>
         // Example starter JavaScript for disabling form submissions if there are invalid fields
          (function () {
            'use strict';
        
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation');
        
            // Loop over them and prevent submission
            Array.prototype.slice.call(forms).forEach(function (form) {
              form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                  event.preventDefault();
                  event.stopPropagation();
                }
        
                form.classList.add('was-validated');
              }, false);
            });
          })();

    async function loginUser(event) {
    event.preventDefault();  // Prevent the default form submission

    // Fetch form values
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    try {
      // Send a POST request to the backend login endpoint
      const response = await fetch('http://localhost:5010/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (response.ok) {
                       
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('role', data.role);

                        // Display a success message
                        alert('Login successful!');

                        // Redirect based on user role
                        if (data.role === 'admin') {
                            window.location.href = '../Admin/Admin.html';  // Redirect admin
                        } else if (data.role === 'user') {
                            window.location.href = '../Pages/index.html';  // Redirect user to homepage
                        }
                    } else {
                        // Handle login failure
                       
                        console.error('Login failed:', errorData);
                        $('#failed-modal-container').load('../Assets/Styles/log_fail.css', function () {
                            $("#failModal").modal("show");
                        });
                    }
                } catch (error) {
      
      alert('An error occurred. Please try again.');
    };
  };
  

   
 
    
         </script>

    </body>
</html>
